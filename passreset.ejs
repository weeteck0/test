<!DOCTYPE html>
<html>
<head>
  <title>Reset Password</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            background: linear-gradient(to right, hsl(210, 62%, 85%), #86adf5); 
            display: flex;
            justify-content: center;
            align-items: center;
        }
</style>
  <div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="card p-4 shadow" style="width: 100%; max-width: 400px;">
      <h3 class="text-center mb-4">Reset Password</h3>

      <% if (messages && messages.length > 0) { %>
        <div class="alert alert-danger">
          <% messages.forEach(function(message) { %>
            <p><%= message %></p>
          <% }); %>
        </div>
      <% } %>

      <div class="alert alert-success mb-3">
        <small><i class="fas fa-check-circle"></i> Please enter your new password for: <strong><%= email %></strong></small>
      </div>

        <form action="/resetpass" method="POST">
            <div class="mb-3">
            <label for="email" class="form-label">Email:</label>
            <input type="email" id="email" name="email" value="<%= email %>" class="form-control" readonly>
            </div>

            <div class="mb-3">
            <label for="password" class="form-label">New Password:</label>
            <input type="password" id="password" name="password" class="form-control" minlength="6" required>
            </div>

            <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm Password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" minlength="6" required>
            <div id="passwordError" class="text-danger mt-1" style="display: none;">
                Passwords do not match!
            </div>
            </div>

            <div class="d-grid gap-2">
            <button type="submit" id="submitBtn" class="btn btn-primary" disabled>Reset Password</button>
            </div>
        </form>
    </div>
</div>

<script>
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const submitBtn = document.getElementById('submitBtn');
    const passwordError = document.getElementById('passwordError');

    function validatePasswords() {
        const passwordValue = password.value;
        const confirmPasswordValue = confirmPassword.value;
        
        if (passwordValue && confirmPasswordValue) {
            if (passwordValue === confirmPasswordValue && passwordValue.length >= 6) {
                // Passwords match and meet requirements
                submitBtn.disabled = false;
                submitBtn.classList.remove('btn-secondary');
                submitBtn.classList.add('btn-primary');
                passwordError.style.display = 'none';
                confirmPassword.classList.remove('is-invalid');
                confirmPassword.classList.add('is-valid');
            } else {
                // Passwords don't match or don't meet requirements
                submitBtn.disabled = true;
                submitBtn.classList.remove('btn-primary');
                submitBtn.classList.add('btn-secondary');
                
                if (passwordValue !== confirmPasswordValue && confirmPasswordValue.length > 0) {
                    passwordError.style.display = 'block';
                    confirmPassword.classList.remove('is-valid');
                    confirmPassword.classList.add('is-invalid');
                } else {
                    passwordError.style.display = 'none';
                    confirmPassword.classList.remove('is-invalid', 'is-valid');
                }
            }
        } else {
            // One or both fields are empty
            submitBtn.disabled = true;
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-secondary');
            passwordError.style.display = 'none';
            confirmPassword.classList.remove('is-invalid', 'is-valid');
        }
    }

    // Add event listeners
    password.addEventListener('input', validatePasswords);
    confirmPassword.addEventListener('input', validatePasswords);
    
    // Prevent form submission if passwords don't match
    document.querySelector('form').addEventListener('submit', function(e) {
        if (password.value !== confirmPassword.value || password.value.length < 6) {
            e.preventDefault();
            passwordError.style.display = 'block';
            return false;
        }
    });
</script>

</body>
</html>
